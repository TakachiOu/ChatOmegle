<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>دردشة TaKaChi - دردشة سرية</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* إعادة تعيين التنسيق الأساسي */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    :root {
      --primary-color: #3498db;
      --secondary-color: #9b59b6;
      --accent-color: #66a6ff;
      --light-bg: #ffffff;
      --dark-bg: #1e1e1e;
      --text-color: #333;
      --light-text: #fff;
      --transition: 0.3s;
    }
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #89f7fe, #66a6ff);
      color: var(--text-color);
      direction: rtl;
      overflow-x: hidden;
      transition: background var(--transition), color var(--transition);
    }
    body.dark-mode {
      background: var(--dark-bg);
      color: var(--light-text);
    }
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(5px);
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    header .logo {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--primary-color);
    }
    header nav a {
      margin-left: 15px;
      text-decoration: none;
      color: var(--text-color);
      font-weight: bold;
      transition: color var(--transition);
    }
    header nav a:hover {
      color: var(--primary-color);
    }
    .toggle-dark-mode {
      background: transparent;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: var(--text-color);
      transition: color var(--transition);
    }
    body.dark-mode header,
    body.dark-mode .toggle-dark-mode,
    body.dark-mode header nav a {
      color: var(--light-text);
    }
    /* صفحة الهبوط */
    #landingPage { padding-top: 80px; }
    .hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      background: url('https://source.unsplash.com/1600x900/?technology,chat') center/cover no-repeat;
      position: relative;
    }
    .hero::before {
      content: "";
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1;
    }
    .hero * { position: relative; z-index: 2; }
    .brand-name {
      font-size: 3.5rem;
      font-weight: bold;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 2px 2px 10px rgba(0,0,0,0.2);
      margin-bottom: 20px;
      animation: fadeIn 1s ease forwards;
    }
    .hero h1 {
      font-size: 2.8rem;
      margin-bottom: 20px;
      color: #fff;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      animation: fadeIn 1s ease forwards;
    }
    .hero p {
      font-size: 1.5rem;
      margin-bottom: 30px;
      color: #eee;
      text-shadow: 1px 1px 5px rgba(0,0,0,0.2);
      animation: fadeIn 1s ease forwards;
    }
    .cta-btn {
      padding: 15px 30px;
      background: var(--light-bg);
      color: var(--primary-color);
      border: none;
      border-radius: 50px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: transform var(--transition), background var(--transition);
      animation: fadeIn 1s ease forwards;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .cta-btn:hover {
      transform: scale(1.05);
      background: #f0f0f0;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    section {
      padding: 60px 20px;
      max-width: 1200px;
      margin: auto;
    }
    section h2 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: var(--primary-color);
    }
    .features {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .feature {
      background: var(--light-bg);
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      flex: 1 1 300px;
      max-width: 300px;
      padding: 20px;
      text-align: center;
      transition: transform var(--transition), box-shadow var(--transition);
    }
    .feature:hover {
      transform: translateY(-10px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .feature i {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    .feature h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: var(--text-color);
    }
    .feature p {
      font-size: 1rem;
      color: #666;
      line-height: 1.5;
    }
    .rules {
      background: rgba(255,255,255,0.95);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: auto;
    }
    .rules ul { list-style: none; margin-top: 20px; }
    .rules li {
      margin-bottom: 10px;
      font-size: 1.1rem;
      padding-right: 25px;
      position: relative;
      line-height: 1.6;
    }
    .rules li::before {
      content: "\f00c";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      position: absolute;
      right: 0;
      top: 0;
      color: var(--primary-color);
    }
    footer {
      text-align: center;
      padding: 20px;
      background: rgba(255,255,255,0.85);
      margin-top: 40px;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }
    /* واجهة الدردشة */
    #chatInterface {
      display: none;
      flex-direction: column;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, #fdfbfb, #ebedee);
      position: relative;
      padding-top: 60px;
      transition: background var(--transition);
    }
    body.dark-mode #chatInterface {
      background: linear-gradient(135deg, #2c3e50, #4ca1af);
    }
    .chat-header {
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      padding: 15px 20px;
      font-size: 1.5rem;
      position: fixed;
      top: 60px;
      width: 100%;
      left: 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 900;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .chat-header button.disconnect {
      background: #e74c3c;
      border: none;
      color: #fff;
      cursor: pointer;
      font-size: 1rem;
      padding: 8px 12px;
      border-radius: 5px;
      transition: background var(--transition), transform 0.3s;
    }
    .chat-header button.disconnect:hover {
      background: #c0392b;
      transform: scale(1.05);
    }
    .chat-messages {
      flex: 1;
      padding: 100px 20px 80px 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .chat-message {
      max-width: 80%;
      padding: 12px 18px;
      border-radius: 20px;
      position: relative;
      background: var(--primary-color);
      color: #fff;
      align-self: flex-end;
      animation: messageIn 0.5s ease forwards;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      word-break: break-word;
      font-size: 1rem;
    }
    @keyframes messageIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .chat-message.received {
      background: var(--light-bg);
      color: var(--text-color);
      align-self: flex-start;
      border: 1px solid #ddd;
    }
    .chat-message .timestamp {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.8);
      position: absolute;
      bottom: -18px;
      right: 12px;
    }
    .chat-message.received .timestamp {
      color: #666;
      right: auto;
      left: 12px;
    }
    .chat-input-container {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: var(--light-bg);
      padding: 10px 20px;
      border-top: 1px solid #ddd;
      display: flex;
      align-items: center;
      transition: background var(--transition);
      z-index: 1000;
    }
    body.dark-mode .chat-input-container {
      background: #2e2e2e;
      border-top: 1px solid #444;
    }
    .chat-input-container input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: 25px;
      font-size: 1rem;
      transition: background var(--transition), color var(--transition);
      outline: none;
    }
    body.dark-mode .chat-input-container input {
      background: #444;
      color: var(--light-text);
      border: 1px solid #555;
    }
    .chat-input-container button.send {
      padding: 10px 15px;
      margin-left: 10px;
      border: none;
      background: var(--primary-color);
      color: #fff;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1rem;
      transition: background var(--transition);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .chat-input-container button.send:hover {
      background: var(--secondary-color);
    }
    /* زر الإيموجي كبير وواضح */
    .chat-input-container button.emoji-btn {
      background: transparent;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      margin-right: 10px;
      transition: transform 0.2s;
    }
    .chat-input-container button.emoji-btn:hover {
      transform: scale(1.2);
    }
    /* لوحة الإيموجي */
    #chatEmojiPicker {
      display: none;
      position: absolute;
      bottom: 60px;
      left: 20px;
      right: 20px;
      background: var(--light-bg);
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-height: 300px;
      overflow-y: auto;
      z-index: 1100;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
      gap: 5px;
    }
    #chatEmojiPicker .emoji {
      cursor: pointer;
      font-size: 1.6rem;
      padding: 5px;
      transition: transform 0.2s;
      text-align: center;
    }
    #chatEmojiPicker .emoji:hover {
      transform: scale(1.2);
    }
    /* شريط التمرير المخصص */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    ::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 10px; }
    @media(max-width:768px){
      .brand-name { font-size: 2.8rem; }
      .hero h1 { font-size: 2.2rem; }
      .hero p { font-size: 1.2rem; }
      section h2 { font-size: 2rem; }
      .feature { max-width: 90%; }
      .chat-message { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <!-- صفحة الهبوط -->
  <div id="landingPage">
    <header>
      <div class="logo">دردشة أمة</div>
      <nav>
        <a href="#home">الرئيسية</a>
        <a href="#features">المميزات</a>
        <a href="#rules">القوانين</a>
        <a href="#chat">الدردشة</a>
      </nav>
      <button class="toggle-dark-mode" onclick="toggleDarkMode()">🌙</button>
    </header>
    <section class="hero" id="home">
      <div class="brand-name">TaKaChi</div>
      <h1>دردشة آمنة وسرية بلا حدود</h1>
      <p>استمتع بتجربة دردشة خاصة ومشفرة دون الحاجة لتسجيل الدخول. تواصل بحرية وخصوصية تامة.</p>
      <button class="cta-btn" onclick="startChat()">ابدأ الدردشة</button>
    </section>
    <section id="features">
      <h2>مميزات الموقع</h2>
      <div class="features">
        <div class="feature">
          <i class="fas fa-user-secret"></i>
          <h3>خصوصية تامة</h3>
          <p>لن نقوم بتخزين محادثاتك أو بياناتك الشخصية، مما يضمن سرية معلوماتك دائماً.</p>
        </div>
        <div class="feature">
          <i class="fas fa-lock"></i>
          <h3>تشفير آمن</h3>
          <p>تقنيات تشفير متطورة تحمي محادثاتك وتمنع أي تسرب للبيانات.</p>
        </div>
        <div class="feature">
          <i class="fas fa-user-check"></i>
          <h3>بلا تسجيل</h3>
          <p>انضم مباشرة وابدأ الدردشة دون الحاجة إلى إنشاء حساب.</p>
        </div>
        <div class="feature">
          <i class="fas fa-comments"></i>
          <h3>مجتمع حر</h3>
          <p>تواصل مع أشخاص من مختلف الخلفيات في بيئة مفتوحة وآمنة للتعبير عن آرائك.</p>
        </div>
      </div>
    </section>
    <section id="rules">
      <h2>قوانين الاستخدام</h2>
      <div class="rules">
        <ul>
          <li>احترام الآخرين وتجنب الإهانات الشخصية.</li>
          <li>منع نشر محتوى مخالف للقانون أو للأخلاق العامة.</li>
          <li>الامتناع عن استخدام المنصة لنشر الكراهية أو التحريض على العنف.</li>
          <li>عدم مشاركة محتوى محمي بحقوق الطبع والنشر دون إذن.</li>
          <li>الحفاظ على سرية المحادثات وعدم نشرها خارج المنصة.</li>
          <li>المنصة لا تتطلب تسجيل دخول لضمان سهولة الاستخدام وخصوصية المستخدم.</li>
        </ul>
      </div>
    </section>
    <section id="chat">
      <h2>ابدأ الدردشة</h2>
      <div class="chat-section" style="text-align: center; animation: fadeIn 1s ease forwards;">
        <p style="font-size: 1.2rem;">انقر على زر "ابدأ الدردشة" لتحويل الصفحة إلى واجهة دردشة خاصة.</p>
      </div>
    </section>
    <footer>
      <p>&copy; 2025 جميع الحقوق محفوظة - دردشة أمة</p>
    </footer>
  </div>

  <!-- واجهة الدردشة -->
  <div id="chatInterface">
    <div class="chat-header">
      <span>واجهة الدردشة الخاصة</span>
      <button class="disconnect" id="disconnectBtn" title="قطع الاتصال والتبديل">
        <i class="fas fa-power-off"></i> قطع الاتصال
      </button>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-container">
      <button class="emoji-btn" id="chatEmojiBtn" title="إضافة إيموجي">😊</button>
      <input type="text" id="chatInput" placeholder="اكتب رسالة...">
      <button class="send" id="chatSendBtn">اتصال</button>
      <div id="chatEmojiPicker"></div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let chatActive = false;

    // بدء الدردشة من صفحة الهبوط
    function startChat() {
      document.getElementById("landingPage").style.display = "none";
      document.getElementById("chatInterface").style.display = "flex";
      document.getElementById("chatInput").disabled = false;
      document.getElementById("chatSendBtn").textContent = "اتصال";
      socket.emit("joinChat");
    }

    // استقبال إشعار الانتظار
    socket.on("waiting", function(message) {
      const sysMsg = document.createElement("div");
      sysMsg.classList.add("chat-message", "received");
      sysMsg.style.fontStyle = "italic";
      sysMsg.textContent = message;
      document.getElementById("chatMessages").appendChild(sysMsg);
      document.getElementById("chatMessages").scrollTop = document.getElementById("chatMessages").scrollHeight;
      chatActive = false;
      document.getElementById("chatSendBtn").textContent = "اتصال";
    });

    // عند بدء الدردشة (تم العثور على شريك)
    socket.on("chat started", function(data) {
      const sysMsg = document.createElement("div");
      sysMsg.classList.add("chat-message", "received");
      sysMsg.style.fontStyle = "italic";
      sysMsg.textContent = "تم العثور على شريك للدردشة. يمكنك الآن بدء المحادثة.";
      document.getElementById("chatMessages").appendChild(sysMsg);
      document.getElementById("chatMessages").scrollTop = document.getElementById("chatMessages").scrollHeight;
      chatActive = true;
      document.getElementById("chatInput").disabled = false;
      document.getElementById("chatSendBtn").textContent = "إرسال";
    });

    // عند خروج الشريك من الدردشة
    socket.on("partner left", function(message) {
      const sysMsg = document.createElement("div");
      sysMsg.classList.add("chat-message", "received");
      sysMsg.style.fontStyle = "italic";
      sysMsg.textContent = message;
      document.getElementById("chatMessages").appendChild(sysMsg);
      document.getElementById("chatMessages").scrollTop = document.getElementById("chatMessages").scrollHeight;
      chatActive = false;
      document.getElementById("chatInput").disabled = false;
      document.getElementById("chatSendBtn").textContent = "اتصال";
    });

    // إرسال الرسالة عند الضغط على زر الإرسال/اتصال
    document.getElementById("chatSendBtn").addEventListener("click", function() {
      if (!chatActive) {
        document.getElementById("chatMessages").innerHTML = "";
        socket.emit("joinChat");
      } else {
        sendChatMessage();
      }
    });

    // دعم الإرسال عبر مفتاح Enter
    document.getElementById("chatInput").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        if (chatActive) {
          sendChatMessage();
        }
      }
    });

    // دالة إرسال الرسالة
    function sendChatMessage() {
      const chatInput = document.getElementById("chatInput");
      const message = chatInput.value.trim();
      if (message !== "") {
        let msgDiv = document.createElement("div");
        msgDiv.classList.add("chat-message");
        msgDiv.textContent = message;
        let timeSpan = document.createElement("span");
        timeSpan.classList.add("timestamp");
        let now = new Date();
        let hours = now.getHours();
        let minutes = now.getMinutes();
        if (minutes < 10) minutes = "0" + minutes;
        timeSpan.textContent = hours + ":" + minutes;
        msgDiv.appendChild(timeSpan);
        document.getElementById("chatMessages").appendChild(msgDiv);
        document.getElementById("chatMessages").scrollTop = document.getElementById("chatMessages").scrollHeight;
        socket.emit("chat message", message);
        chatInput.value = "";
      }
    }

    // استقبال الرسائل من الطرف الآخر
    socket.on("chat message", function(msg) {
      let msgDiv = document.createElement("div");
      msgDiv.classList.add("chat-message", "received");
      msgDiv.textContent = msg;
      let timeSpan = document.createElement("span");
      timeSpan.classList.add("timestamp");
      let now = new Date();
      let hours = now.getHours();
      let minutes = now.getMinutes();
      if (minutes < 10) minutes = "0" + minutes;
      timeSpan.textContent = hours + ":" + minutes;
      msgDiv.appendChild(timeSpan);
      document.getElementById("chatMessages").appendChild(msgDiv);
      document.getElementById("chatMessages").scrollTop = document.getElementById("chatMessages").scrollHeight;
    });

    // زر قطع الاتصال: يفصل الطرفين ويعيدهما للانتظار
    document.getElementById("disconnectBtn").addEventListener("click", function() {
      if (confirm("هل أنت متأكد من قطع الاتصال والتبديل لشخص آخر؟")) {
        socket.emit("leaveChat");
        document.getElementById("chatMessages").innerHTML = "";
        chatActive = false;
        document.getElementById("chatInput").value = "";
        document.getElementById("chatSendBtn").textContent = "اتصال";
        setTimeout(function() {
          socket.emit("joinChat");
        }, 500);
      }
    });

    // زر عرض/إخفاء لوحة الإيموجي
    const chatEmojiBtn = document.getElementById("chatEmojiBtn");
    const chatEmojiPicker = document.getElementById("chatEmojiPicker");

    chatEmojiBtn.addEventListener("click", function() {
      if (chatEmojiPicker.style.display === "none" || chatEmojiPicker.style.display === "") {
        chatEmojiPicker.style.display = "grid";
      } else {
        chatEmojiPicker.style.display = "none";
      }
    });

    // قائمة واسعة من الإيموجي
    const emojiList = [
      "😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇",
      "🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚",
      "😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩",
      "🥳","😏","😒","😞","😔","😟","😕","🙁","☹️","😣",
      "😖","😫","😩","🥺","😢","😭","😤","😠","😡","🤬",
      "🤯","😳","🥵","🥶","😱","😨","😰","😥","😓","🤗",
      "🤔","🤭","🤫","🤥","😶","😐","😑","😬","🙄","😯",
      "😦","😧","😮","😲","🥱","😴","🤤","😪","😵","🤐",
      "🥴","🤢","🤮","🤧","😷","🤒","🤕","🤑","😈","👿",
      "👹","👺","🤡","💩","👻","💀","☠️","👽","👾","🤖",
      "🎃","🌞","🌝","🌚","🌕","🌖","🌗","🌘","🌑","🌒",
      "🌓","🌔","🌙","🌎","🌍","🌏","💫","⭐","🌟","✨"
    ];
    
    emojiList.forEach(emoji => {
      let span = document.createElement("span");
      span.classList.add("emoji");
      span.textContent = emoji;
      span.addEventListener("click", function() {
        document.getElementById("chatInput").value += emoji;
        chatEmojiPicker.style.display = "none";
        document.getElementById("chatInput").focus();
      });
      chatEmojiPicker.appendChild(span);
    });

    // تبديل الوضع الليلي
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
    }
  </script>
</body>
</html>
